# Refactoring

## CH 03 코드에서 나는 악취

### 3.1 기이한 이름(Mysterious Name)

- 코드를 명료하게 표현하는 데 가장 중요한 요소는 바로 이름이다.
- 이름만 보고도 무슨 일을 하고 어떻게 사용해야 하는지 명확히 알 수 있도록 엄청나게 신경 써야 한다.
- 마땅한 이름이 떠오르지 않는다면, 설계에 더 근본적인 문제가 숨어 있을 가능성이 높다.
- 이름을 잘 정리하다보면 코드가 훨씬 간결해질 때가 많다.

### 3.2 중복 코드(Duplicated Code)

- 똑같은 코드 구조가 여러 곳에서 반복된다면 하나로 통합하여 더 나은 프로그램을 만들 수 있다.
- 중복 내용이 있다면 함수로 추출하여 사용한다.
- 비슷한데 완전 같지 않다면, 문장을 슬라이드하여 비슷한 부분을 한 곳에 모아 함수로 추출한다.
- 서브 클래스에 중복 내용이 있다면, 메서드 올려 부모로 옮긴다.

### 3.3 긴 함수(Long Function)

- 짧은 함수는 간접 호출(indirection)의 효과, 즉 코드를 이해하고 공유하고 선택하기 쉬워진다.
- 예전에는 서브루틴을 호출하는 비용이 컸지만, 요즘 언어는 함수 호출 비용을 거의 없애버렸다.
- 주석을 달아야 할 만한 부분은 무조건 함수로 만들고, 함수 이름은 동작 방식이 아닌 의도(intention)가 드러나게 짓는다.
- 무엇을 하는지를 코드가 잘 설명해주지 못할수록 함수로 만드는게 유리하다.
- 함수가 매개변수와 임시 변수를 많이 사용한다면 추출하는데 방해가 된다.
  - 임시 변수를 질의 함수로 바꾸거나, 매개변수 객체 만들기와 객체 통째로 넘기기로 매개변수의 수를 줄일 수 있다.
- 코드가 단 한 줄이어도 따로 설명할 필요가 있다면 함수로 추출하는 게 좋다.
- 조건문이나 반복문도 추출 대상의 실마리를 제공한다.

### 3.4 긴 매개변수 목록(Long Parameter List)

- 매개변수 목록이 길어지면 그 자체로 이해하기 어려울 때가 많다.
- 매개변수 중 다른 매개변수로 값을 얻어올 수 있는데 매개변수가 있는데, 이를 매개변수를 질의 함수로 바꾸기로 제거한다.
- 사용중인 데이터 구조에서 값들을 뽑아 각각을 별개의 매개변수로 전달하는 코드라면 객체 통째로 넘기기로 원본 데이터 구조를 그대로 전달한다.
- 항상 함께 전달되는 매개변수들은 매개변수 객체 만들기로 하나로 묶는다.
- 함수의 동작 방식을 정하는 플래그 역할의 매개변수는 플래그 인수 제거하기로 없애준다.
- 여러 개의 함수가 특정 매개변수들의 갑슬 공통으로 사용할 때는, 여러 함수를 클래스로 묶기를 이용하여 공통 값들을 클래스 필드로 정의한다.
  - 함수형 프로그래밍이라면 일련의 부분 적용 함수(partially applied function)들을 생성한다.

### 3.5 전역 데이터(Global Data)

- 전역 데이터는 어디에서든 건드릴 수 있고 값을 누가 바꿨는지 찾아낼 메커니즘이 없어, 버그의 원인이 된다.
- 이를 방지하기 위해 변수를 캡슐화한다.

### 3.6 가변 데이터(Mutable Data)

- 함수형 프로그래밍에서 데이터는 절대 변하지 않고, 데이터를 변경하려면 반드시 변경하려는 값에 해당하는 복사본을 만들어서 반환한다.
- 변수 캡슐화하기를 적용하여 정해놓은 함수를 거쳐야만 값을 수정할 수 있도록 하면 값이 어떻게 수정되는지 감시하거나 코드를 개선하기 쉽다.
- 하나의 변수에 용도별로 독립 변수에 저장하느라 값을 갱신하는 경우라면 변수 쪼개기를 이용하여 용도별로 독립 변수에 저장하게 하여 값 갱신이 문제를 일으킬 여지를 없앤다.
- 갱신 로직은 다른 코드와 떨어뜨려 놓는 것이 좋다.
  - 문장 슬라이드하기와 함수 추출하기를 이용해서 무언가를 갱신하는 코드로부터 부작용이 없는 코드를 분리한다.
- API를 만들 때는 질의 함수와 변경 함수 분리하기를 활용해서 꼭 필요한 경우가 아니라면 부작용이 있는 코드를 호출할 수 없게 한다.
- 가능한 한 세터 제거하기도 적용한다.
  - 세터를 호출하는 클라리언트를 찾는 것만으로도 변수의 유효 범위를 줄이는 데 도움될 때가 있다.
- 값을 다른 곳에서 설정할 수 있는 가변 데이터는 파생 변수를 질의 함수로 바꾼다.
- 변수의 유효 범위가 넓어지면, 여러 함수를 클래스로 묶기나, 여러 함수를 변환 함수로 묶기를 활용해서 변수를 갱신하는 코드들의 유효범위를 제한한다.
- 구조체처럼 내부 필드에 데이터를 담고 있는 변수라면, 참조를 값으로 바꾸기를 적용하여 내부 필드를 직접 수ㅠ정하지 말고 구조체를 통째로 교체하는 편이 낫다.
