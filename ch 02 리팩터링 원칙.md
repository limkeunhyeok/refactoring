# Refactoring

## CH 02 리팩터링 원칙

### 2.1 리팩터링 정의

> 리팩터링이란 소프트웨어의 겉보기 동작은 그대로 유지한 채, 코드를 이해하고 수정하기 쉽도록 내부 구조를 변경하는 기법이다. 리팩터링의 목적은 코드를 이해하고 수정하기 쉽게 만드는 것이다.

### 2.2 두 개의 모자

- 기능 추가 시에는 기존 코드를 절대 건드리지 말고, 새 기능을 추가하기만 한다.
- 리팩터링할 때는 기능 추가없이 코드 재구성만 한다.

> 어떤 작업을 하든 분명하게 인지한다.

### 2.3 리팩터링하는 이유

1. 소프트웨어 설계가 좋아진다.
2. 소프트웨어를 이해하기 쉬워진다.
3. 버그를 쉽게 찾을 수 있다.
4. 프로그래밍 속도를 높일 수 있다.

- 모듈화와 명확한 설계, 좋은 품질의 베이스 코드는 새로운 기능을 추가하기 쉽게 만든다.

### 2.4 언제 리팩터링해야 할까?

- 기능을 새로 추가히기 직전에, 비슷한 코드가 보이면 복사하기 보다는 리팩터링한다.
- 코드를 파악하면, 이해한 내용을 코드에 반영한다.
  - 코드를 분석할 때 리팩터링 해보면, 깊은 수준까지 이해하게 된다.
- 간단하다면 즉시 수정하고, 시간이 걸린다면 메모하고 추후에 처리한다.
- 수시로 리팩터링한다.
- 오래 걸리는 리팩터링은 작게 나눠서 조금씩 한다.
  - 추상화된 인터페이스를 마련한다(추상화로 갈아타기, Branch By Abstraction).
- 코드 리뷰에 리팩터링을 활용한다.
- 자주 사용하는 코드나 새로 만드는게 나아 보이는 코드는 리팩터링을 하지 않는다.
  - 자주 사용하는 코드는 내부 동작을 이해해야 할 시점에 리팩터링한다.

### 2.5 리팩터링 시 고려할 문제

- 리팩터링은 기능 추가 시간을 줄이고, 버그 수정 시간을 줄이는 등 경제적인 이유로 한다.
- 코드 소유권은 개인보다는 팀 단위가 좋다.
- 브랜치는 자주 통합되어야 리팩터링에 좋다.
- 오류를 재빨리 잡기 위해, 자가 테스트 코드를 마련해야 한다.
- 레거시 코드가 있다면, 테스트 코드 먼저 작성한다.
- 데이터베이스 리팩터링기법은 커다란 변경들을 쉽게 조합하고 다룰 수 있는 데이터 마이그레이션 스크립트를 작성하고, 접근 코드와 데이터베이스 스키마에 대한 구조적 변경을 이 스크립트로 처리하게끔 통합한다.

### 2.6 리팩터링, 아키텍처, 애그니(YAGNI)

- 리팩터링이 아키텍처에 미치는 실질적인 효과는 요구사항 변화에 자연스럽게 대응하도록 코드베이스를 잘 설계해준다는 데 있다.
- 변화를 예상하고, 유연하게 대응하려다 보면 장황해진다.
  - 그저 현재 파악한 요구사항만 멋지게 설계하고 해결한다.
  - 진행하면서 요구사항을 알게 된다면 그에 맞게 리팩터링한다.
  - 하지만 앞으로의 변경이 뻔히 보이고 그것이 리팩터링을 어렵게 만든다면, 그때 유연성 매커니즘을 추가한다.(애그니: you aren't going to need it)
  - 선제적인 설계와 점진적 설계의 균형.
  - 후자에 더 무게를 둔 진화형 아키텍처
  - 설계에 관한 결정을 시간을 두고 반복해서 내린다.
